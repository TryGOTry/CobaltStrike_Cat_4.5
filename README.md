# 2023-05-01 æ›´æ–°æœ€ç»ˆç‰ˆï¼Œä»¥åå°†ä¸å†æ›´æ–°.
## æ›´æ–°è¯´æ˜[æ›´æ–°è¯´æ˜](https://github.com/TryGOTry/CobaltStrike_Cat_4.5/blob/main/README_END.md)

# CobaltStrike-[Cat]-4.5-å…”å¹´å¿«ä¹

> Ps:çŒ«çŒ«ğŸ±Cs:åŸºäºCobaltStrike4.5äºŒå¼€å®Œæˆ (åŸdogcs4.4äºŒå¼€åŠŸèƒ½åŸºæœ¬éƒ½æœ‰)(è‡ªå¸¦ç ´è§£,ä¸éœ€è¦ä½¿ç”¨csagent.)
>
> è‡ªå®šä¹‰å±äºä½ è‡ªå·±çš„CobaltStrike,æ–¹ä¾¿ä¸€äº›ä¸ä¼šäºŒå¼€çš„æœ‹å‹ä½¿ç”¨ï½æœ¬äººåªæµ‹è¯•äº†httpsä¸Šçº¿,å¦‚æœ‰bugè¯·åœ¨lssuesä¸­æå‡º.
>
> By: T00ls.com

## ç›¸å…³é…ç½®

`Javaç‰ˆæœ¬:11 è¿è¡Œå‰è¯·å…ˆé…ç½®CatClient.properties`

#### å®¢æˆ·ç«¯

> **å³è¾¹ğŸ‘‰ä¸‹è½½çš„è‡ªå¸¦java11ç¯å¢ƒ,ç›´æ¥è¿è¡Œruncatcs.vbså³å¯(ä»…é™windows),å…¶ä»–ç³»ç»Ÿæ‰§è¡Œ:java -jar cat_client.jar client**

##### é…ç½®æ–‡ä»¶è¯´æ˜(CatClient.properties)

|        é…ç½®å        |                           é…ç½®è¯´æ˜                           |
| :------------------: | :----------------------------------------------------------: |
|  CatClient.Version   | è‡ªå®šä¹‰ç‰ˆæœ¬å·,éœ€è¦å’ŒæœåŠ¡ç«¯ä¸€è‡´.(åˆ«äººæ‹¿åˆ°è¿™ä¸ªç‰ˆæœ¬çš„csä¿¡æ¯,å¦‚æœç‰ˆæœ¬å·ä¸å¯¹,ä¹Ÿæ— æ³•ç™»å½•TeamSever):String |
|  CatClient.OpenAuth  | æ˜¯å¦å¼€å¯authéªŒè¯,éœ€è¦å’ŒæœåŠ¡ç«¯å¯¹åº”(å¼€å¯åå®‰å…¨æ€§è¾ƒé«˜,ä½†æ˜¯å®¢æˆ·ç«¯æ— æ³•æ–­çº¿é‡è¿)ï¼štrue,false |
| CatClient.InjectSelf | æ˜¯å¦æ³¨å…¥è‡ªèº«,å¼€å¯çš„è¯Desktopï¼ŒKeylogger,Hashdump,PortScan,Mimikatz,PowerShellUnmanaged,Printscreen,Screenshot,Screenwatchä¼šæ³¨å…¥è‡ªèº«(å¼€å¯åæ— æ³•é€‚é…geacon_pro)ï¼štrue,false |
|   CatClient.theme    |            å®¢æˆ·ç«¯ä¸»é¢˜é…ç½®,0æ˜¯åŸç‰ˆ,1æ˜¯ç™½è‰²,2æ˜¯é»‘è‰²            |
|  CatClient.ini_name  |            è‡ªå®šä¹‰é…ç½®æ–‡ä»¶å­˜æ”¾åç§°,é˜²æ­¢è¢«èœœç½è¯»å–             |
| stager.checksum-num  |     å…³äºstagerçš„ç›¸å…³é…ç½®(å¼ºçƒˆå»ºè®®ç”¨profileæ–‡ä»¶è‡ªå®šä¹‰url)     |
|    stager.x86-num    |                     å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éœ€ä¸€è‡´                     |
|  stager.x86-uri-len  |                     å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éœ€ä¸€è‡´                     |
|    stager.x64-num    |                     å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éœ€ä¸€è‡´                     |
|  stager.x64-uri-len  |                     å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éœ€ä¸€è‡´                     |

##### ç›¸å…³æˆªå›¾

> ç™½è‰²ä¸»é¢˜

![ç™½è‰²](./theme1.png)

> æš—é»‘ä¸»é¢˜

![æš—é»‘](./theme2.png)

> ç‰ˆæœ¬ä¸å¯¹é”™è¯¯æç¤º

![version_err](./version_err.png)

---

#### æœåŠ¡ç«¯

```bash
æ¨èä½¿ç”¨ubuntu18è¿è¡Œ
sudo apt install openjdk-11-jre-headless
sudo apt install openjdk-11-jdk
```

> **éœ€Java11è¿è¡Œï¼Œè¿è¡Œå‰è¯·å…ˆé…ç½®CatServer.properties**

##### é…ç½®æ–‡ä»¶è¯´æ˜(CatServer.properties)

|          é…ç½®å          |                           é…ç½®è¯´æ˜                           |
| :----------------------: | :----------------------------------------------------------: |
|    CatServer.Version     | è‡ªå®šä¹‰ç‰ˆæœ¬å·,éœ€è¦å’Œå®¢æˆ·ç«¯ä¸€è‡´.(åˆ«äººæ‹¿åˆ°è¿™ä¸ªç‰ˆæœ¬çš„csä¿¡æ¯,å¦‚æœç‰ˆæœ¬å·ä¸å¯¹,ä¹Ÿæ— æ³•ç™»å½•TeamSever)ï¼Œå¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ä¸² |
|      CatServer.port      |                          æœåŠ¡ç«¯ç«¯å£                          |
|     CatServer.store      |               TeamServerè¯ä¹¦æ–‡ä»¶(éœ€æ”¾å½“å‰ç›®å½•)               |
| CatServer.store-password |                           è¯ä¹¦å¯†ç                            |
|      CatServer.host      |    æœåŠ¡å™¨ip(å¯éšæ„å¡«å†™,åªæ˜¯å®¢æˆ·ç«¯ç›‘å¬æ—¶å€™ä¼šé»˜è®¤æ˜¾ç¤ºçš„ip)     |
|    CatServer.password    |                          æœåŠ¡ç«¯å¯†ç                           |
|  CatServer.profile-name  |                       profileæ–‡ä»¶åç§°                        |
|    CatServer.profile     | ä½¿ç”¨çš„profileæ–‡ä»¶,éœ€æ”¾åœ¨å½“å‰ç›®å½•ä¸‹(æ‰€ä»¥å¿…é¡»ä½¿ç”¨profileå¯åŠ¨)  |
|      CatServer.auth      |         æ˜¯å¦å¼€å¯åŒé‡éªŒè¯,éœ€è¦å’Œå®¢æˆ·ç«¯ä¸€è‡´:true,false         |
|    CatServer.authlog     | æ˜¯å¦å¼€å¯ç™»å½•æ—¥å¿—è®°å½•(åªæ˜¯åœ¨å®‰å…¨ç æ­£ç¡®,ä½†æ˜¯å¯†ç é”™è¯¯çš„æƒ…å†µä¸‹è®°å½•.):true,false |
|   CatServer.googleauth   |          å¼€å¯åŒé‡éªŒè¯å,å†å¼€å¯è°·æ­ŒéªŒè¯ç :true,false          |
|   CatServer.googlekey    | è°·æ­ŒäºŒæ¬¡éªŒè¯çš„key(å¯ç”¨java -jar cat_server.jar google å‘½ä»¤ç”Ÿæˆ) |
|    CatServer.safecode    | å¦‚æœå¼€å¯åŒé‡éªŒè¯,ä½†æ˜¯å…³é—­è°·æ­Œçš„è¯,å°±ä¼šå¯åŠ¨å®‰å…¨ç ,å›ºå®šä¸å˜(é™åˆ¶10ä½æ•°) |
|       CatServer.Iv       | AESåŠ å¯†çš„ivå€¼,æ–¹ä¾¿ç±»ä¼¼geacon_proç­‰é‡å†™çš„é¡¹ç›®ï¼Œé™åˆ¶ä¸º16ä½,åˆ‡å‹¿ä¹±æ”¹,ä¼šå‡ºç°æ— æ³•ä¸Šçº¿é—®é¢˜(é»˜è®¤:abcdefghijklmnop) |
|   stager.checksum-num    |     å…³äºstagerçš„ç›¸å…³é…ç½®(å¼ºçƒˆå»ºè®®ç”¨profileæ–‡ä»¶è‡ªå®šä¹‰url)     |
|      stager.x86-num      |                     å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éœ€ä¸€è‡´                     |
|    stager.x86-uri-len    |                     å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éœ€ä¸€è‡´                     |
|      stager.x64-num      |                     å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éœ€ä¸€è‡´                     |
|    stager.x64-uri-len    |                     å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éœ€ä¸€è‡´                     |

##### ç›¸å…³å‘½ä»¤

```bash
è¿è¡ŒæœåŠ¡ç«¯:
chmod 755 teamserver
./teamserver

Windowsä¸‹è¿è¡Œ(æ”¹å¥½é…ç½®æ–‡ä»¶å)
java.exe -jar cat_server.jar server

è·å–googleäºŒæ¬¡éªŒè¯é…ç½®:
java -jar cat_server.jar google
ï¼ˆPs:å°†è·å–åˆ°çš„SecretKeyå¡«å…¥æœåŠ¡ç«¯é…ç½®ä¸­,æŠŠdata:image/jpeg;base64...è¿™ä¸€ä¸²å¤åˆ¶åˆ°æµè§ˆå™¨ä¸­æ‰“å¼€,ç”¨è°·æ­ŒéªŒè¯å™¨æ‰«æï¼‰

è¿è¡Œcnaè„šæœ¬

(å¦‚æœæ²¡å¼€å¯äºŒæ¬¡éªŒè¯)
java -jar cat_server.jar script [host] [port] [user] [password] [cnaè„šæœ¬]

(å¦‚æœå¼€å¯äºŒæ¬¡éªŒè¯)
java -jar cat_server.jar script [host] [port] [user] [password] [äºŒæ¬¡éªŒè¯çš„å¯†ç ] [cnaè„šæœ¬]
```

# ä¸€äº›äºŒå¼€è¯´æ˜

1. å»é™¤ListenerConfigä¸­çš„ç‰¹å¾æ°´å°

2. ä¿®æ”¹Stager Urlï¼ˆchecksum8ï¼‰æ ¡éªŒç®—æ³•

3. ä¿®æ”¹é»˜è®¤ç™»å½•inté•¿åº¦48879,è®©ç½‘ä¸Šçš„çˆ†ç ´è„šæœ¬æ— æ³•çˆ†ç ´

4. ä¿®æ”¹beaconé…ç½®ä¿¡æ¯çš„é»˜è®¤å¯†é’¥,ä¸ä¼šè¢«é»˜è®¤çš„è„šæœ¬è·å–åˆ°é…ç½®ä¿¡æ¯

5. å¢åŠ åœ¨çº¿ä¸»æœºç»Ÿè®¡

6. è‡ªå®šä¹‰bypass 360æ ¸æ™¶æ¨¡å¼:æˆªå›¾,Mimikatz,Hashdumpç­‰

7. å»æ‰é—ç•™çš„æš—æ¡©bug

8. å¯è‡ªå®šä¹‰ä¿®æ”¹é»˜è®¤é…ç½®æ–‡ä»¶å­˜æ”¾æ–‡ä»¶å

9. æ–°åŠ ipå½’å®¿åœ°æŸ¥è¯¢

10. è‡ªå®šä¹‰åŒç«¯ç‰ˆæœ¬å·

    -------------------------------------------------------------

## å…³äºCVE-2022-39197

æ²¡æ‰¾åˆ°å¥½çš„è§£å†³æ–¹æ³•,ç›´æ¥ç”¨è¿™ä¸ªå“¥ä»¬çš„patchè¡¥ä¸å³å¯:https://github.com/burpheart/CVE-2022-39197-patch

### å…³äºå¯†ç 

è§£å‹å¯†ç æ”¾åœ¨T00ls.comä¸­.

https://www.nctry.com/
